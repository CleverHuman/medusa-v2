<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.medusa.mall.mapper.VendorInterviewMapper">
    
    <resultMap type="VendorInterview" id="VendorInterviewResult">
        <result property="id"    column="id"    />
        <result property="applicationId"    column="application_id"    />
        <result property="slotId"    column="slot_id"    />
        <result property="applicationNumber"    column="application_number"    />
        <result property="vendorName"    column="vendor_name"    />
        <result property="interviewDate"    column="interview_date"    />
        <result property="interviewTime"    column="interview_time"    />
        <result property="interviewDatetime"    column="interview_datetime"    />
        <result property="durationMinutes"    column="duration_minutes"    />
        <result property="timezone"    column="timezone"    />
        <result property="interviewType"    column="interview_type"    />
        <result property="platform"    column="platform"    />
        <result property="meetingLink"    column="meeting_link"    />
        <result property="meetingId"    column="meeting_id"    />
        <result property="meetingPassword"    column="meeting_password"    />
        <result property="status"    column="status"    />
        <result property="vendorConfirmed"    column="vendor_confirmed"    />
        <result property="vendorConfirmedTime"    column="vendor_confirmed_time"    />
        <result property="interviewerId"    column="interviewer_id"    />
        <result property="cmId"    column="cm_id"    />
        <result property="cmNotified"    column="cm_notified"    />
        <result property="vendorNotified"    column="vendor_notified"    />
        <result property="interviewerName"    column="interviewer_name"    />
        <result property="interviewerContact"    column="interviewer_contact"    />
        <result property="preparationNotes"    column="preparation_notes"    />
        <result property="interviewNotes"    column="interview_notes"    />
        <result property="interviewResult"    column="interview_result"    />
        <result property="interviewScore"    column="interview_score"    />
        <result property="reminderSent"    column="reminder_sent"    />
        <result property="reminderSentTime"    column="reminder_sent_time"    />
        <result property="notificationSent"    column="notification_sent"    />
        <result property="notificationSentTime"    column="notification_sent_time"    />
        <result property="rescheduleCount"    column="reschedule_count"    />
        <result property="rescheduleReason"    column="reschedule_reason"    />
        <result property="previousDatetime"    column="previous_datetime"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="createBy"    column="create_by"    />
        <result property="updateBy"    column="update_by"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <sql id="selectInterviewVo">
        select id, application_id, slot_id, application_number, vendor_name, interview_date, interview_time, 
               interview_datetime, duration_minutes, timezone, interview_type, platform, meeting_link, 
               meeting_id, meeting_password, status, vendor_confirmed, vendor_confirmed_time, 
               interviewer_id, cm_id, cm_notified, vendor_notified, interviewer_name, interviewer_contact, preparation_notes, interview_notes, 
               interview_result, interview_score, reminder_sent, reminder_sent_time, notification_sent, 
               notification_sent_time, reschedule_count, reschedule_reason, previous_datetime, 
               create_time, update_time, create_by, update_by, remark
        from mall_vendor_interview
    </sql>

    <select id="selectInterviewList" parameterType="VendorInterview" resultMap="VendorInterviewResult">
        <include refid="selectInterviewVo"/>
        <where>
            del_flag = '0'
            <if test="applicationId != null">
                AND application_id = #{applicationId}
            </if>
            <if test="applicationNumber != null and applicationNumber != ''">
                AND application_number like concat('%', #{applicationNumber}, '%')
            </if>
            <if test="vendorName != null and vendorName != ''">
                AND vendor_name like concat('%', #{vendorName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
            <if test="interviewType != null and interviewType != ''">
                AND interview_type = #{interviewType}
            </if>
            <if test="platform != null and platform != ''">
                AND platform = #{platform}
            </if>
            <if test="interviewerId != null">
                AND interviewer_id = #{interviewerId}
            </if>
            <if test="params.beginTime != null and params.beginTime != ''">
                AND date_format(interview_datetime,'%Y-%m-%d') &gt;= date_format(#{params.beginTime},'%Y-%m-%d')
            </if>
            <if test="params.endTime != null and params.endTime != ''">
                AND date_format(interview_datetime,'%Y-%m-%d') &lt;= date_format(#{params.endTime},'%Y-%m-%d')
            </if>
        </where>
        order by interview_datetime desc
    </select>

    <select id="selectInterviewById" parameterType="Long" resultMap="VendorInterviewResult">
        <include refid="selectInterviewVo"/>
        where id = #{id} and del_flag = '0'
    </select>

    <select id="selectInterviewsByApplicationId" parameterType="Long" resultMap="VendorInterviewResult">
        <include refid="selectInterviewVo"/>
        where application_id = #{applicationId} and del_flag = '0'
        order by interview_datetime desc
    </select>

    <select id="selectInterviewsByDateRange" resultMap="VendorInterviewResult">
        <include refid="selectInterviewVo"/>
        <where>
            del_flag = '0'
            <if test="startDate != null">
                AND interview_date &gt;= #{startDate}
            </if>
            <if test="endDate != null">
                AND interview_date &lt;= #{endDate}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        order by interview_datetime asc
    </select>

    <select id="countScheduledInterviews" resultType="int">
        select count(*) from mall_vendor_interview
        where application_id = #{applicationId} 
        and status in ('scheduled', 'confirmed')
        and del_flag = '0'
    </select>

    <insert id="insertInterview" parameterType="VendorInterview" useGeneratedKeys="true" keyProperty="id">
        insert into mall_vendor_interview
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="applicationId != null">application_id,</if>
            <if test="applicationNumber != null">application_number,</if>
            <if test="vendorName != null">vendor_name,</if>
            <if test="interviewDate != null">interview_date,</if>
            <if test="interviewTime != null">interview_time,</if>
            <if test="interviewDatetime != null">interview_datetime,</if>
            <if test="durationMinutes != null">duration_minutes,</if>
            <if test="timezone != null">timezone,</if>
            <if test="interviewType != null">interview_type,</if>
            <if test="platform != null">platform,</if>
            <if test="meetingLink != null">meeting_link,</if>
            <if test="meetingId != null">meeting_id,</if>
            <if test="meetingPassword != null">meeting_password,</if>
            <if test="status != null">status,</if>
            <if test="vendorConfirmed != null">vendor_confirmed,</if>
            <if test="vendorConfirmedTime != null">vendor_confirmed_time,</if>
            <if test="interviewerId != null">interviewer_id,</if>
            <if test="interviewerName != null">interviewer_name,</if>
            <if test="interviewerContact != null">interviewer_contact,</if>
            <if test="preparationNotes != null">preparation_notes,</if>
            <if test="interviewNotes != null">interview_notes,</if>
            <if test="interviewResult != null">interview_result,</if>
            <if test="interviewScore != null">interview_score,</if>
            <if test="reminderSent != null">reminder_sent,</if>
            <if test="reminderSentTime != null">reminder_sent_time,</if>
            <if test="notificationSent != null">notification_sent,</if>
            <if test="notificationSentTime != null">notification_sent_time,</if>
            <if test="rescheduleCount != null">reschedule_count,</if>
            <if test="rescheduleReason != null">reschedule_reason,</if>
            <if test="previousDatetime != null">previous_datetime,</if>
            <if test="createBy != null">create_by,</if>
            <if test="remark != null">remark,</if>
            create_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="applicationId != null">#{applicationId},</if>
            <if test="applicationNumber != null">#{applicationNumber},</if>
            <if test="vendorName != null">#{vendorName},</if>
            <if test="interviewDate != null">#{interviewDate},</if>
            <if test="interviewTime != null">#{interviewTime},</if>
            <if test="interviewDatetime != null">#{interviewDatetime},</if>
            <if test="durationMinutes != null">#{durationMinutes},</if>
            <if test="timezone != null">#{timezone},</if>
            <if test="interviewType != null">#{interviewType},</if>
            <if test="platform != null">#{platform},</if>
            <if test="meetingLink != null">#{meetingLink},</if>
            <if test="meetingId != null">#{meetingId},</if>
            <if test="meetingPassword != null">#{meetingPassword},</if>
            <if test="status != null">#{status},</if>
            <if test="vendorConfirmed != null">#{vendorConfirmed},</if>
            <if test="vendorConfirmedTime != null">#{vendorConfirmedTime},</if>
            <if test="interviewerId != null">#{interviewerId},</if>
            <if test="interviewerName != null">#{interviewerName},</if>
            <if test="interviewerContact != null">#{interviewerContact},</if>
            <if test="preparationNotes != null">#{preparationNotes},</if>
            <if test="interviewNotes != null">#{interviewNotes},</if>
            <if test="interviewResult != null">#{interviewResult},</if>
            <if test="interviewScore != null">#{interviewScore},</if>
            <if test="reminderSent != null">#{reminderSent},</if>
            <if test="reminderSentTime != null">#{reminderSentTime},</if>
            <if test="notificationSent != null">#{notificationSent},</if>
            <if test="notificationSentTime != null">#{notificationSentTime},</if>
            <if test="rescheduleCount != null">#{rescheduleCount},</if>
            <if test="rescheduleReason != null">#{rescheduleReason},</if>
            <if test="previousDatetime != null">#{previousDatetime},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="remark != null">#{remark},</if>
            sysdate()
        </trim>
    </insert>

    <update id="updateInterview" parameterType="VendorInterview">
        update mall_vendor_interview
        <trim prefix="SET" suffixOverrides=",">
            <if test="interviewDate != null">interview_date = #{interviewDate},</if>
            <if test="interviewTime != null">interview_time = #{interviewTime},</if>
            <if test="interviewDatetime != null">interview_datetime = #{interviewDatetime},</if>
            <if test="durationMinutes != null">duration_minutes = #{durationMinutes},</if>
            <if test="timezone != null">timezone = #{timezone},</if>
            <if test="interviewType != null">interview_type = #{interviewType},</if>
            <if test="platform != null">platform = #{platform},</if>
            <if test="meetingLink != null">meeting_link = #{meetingLink},</if>
            <if test="meetingId != null">meeting_id = #{meetingId},</if>
            <if test="meetingPassword != null">meeting_password = #{meetingPassword},</if>
            <if test="status != null">status = #{status},</if>
            <if test="vendorConfirmed != null">vendor_confirmed = #{vendorConfirmed},</if>
            <if test="vendorConfirmedTime != null">vendor_confirmed_time = #{vendorConfirmedTime},</if>
            <if test="interviewerId != null">interviewer_id = #{interviewerId},</if>
            <if test="interviewerName != null">interviewer_name = #{interviewerName},</if>
            <if test="interviewerContact != null">interviewer_contact = #{interviewerContact},</if>
            <if test="preparationNotes != null">preparation_notes = #{preparationNotes},</if>
            <if test="interviewNotes != null">interview_notes = #{interviewNotes},</if>
            <if test="interviewResult != null">interview_result = #{interviewResult},</if>
            <if test="interviewScore != null">interview_score = #{interviewScore},</if>
            <if test="reminderSent != null">reminder_sent = #{reminderSent},</if>
            <if test="reminderSentTime != null">reminder_sent_time = #{reminderSentTime},</if>
            <if test="notificationSent != null">notification_sent = #{notificationSent},</if>
            <if test="notificationSentTime != null">notification_sent_time = #{notificationSentTime},</if>
            <if test="rescheduleCount != null">reschedule_count = #{rescheduleCount},</if>
            <if test="rescheduleReason != null">reschedule_reason = #{rescheduleReason},</if>
            <if test="previousDatetime != null">previous_datetime = #{previousDatetime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="remark != null">remark = #{remark},</if>
            update_time = sysdate()
        </trim>
        where id = #{id}
    </update>

    <update id="deleteInterviewById" parameterType="Long">
        update mall_vendor_interview set del_flag = '2' where id = #{id}
    </update>

    <update id="deleteInterviewByIds" parameterType="String">
        update mall_vendor_interview set del_flag = '2' where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

</mapper>

